<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
<head>
  <title></title>
  <meta name="generator" content="thinktank" />
	<meta http-equiv="Content-Script-Type" content="text/javascript"/>
	<meta http-equiv="Content-Style-Type" content="text/css"/>
  <style type="text/css">code{white-space: pre;}</style>
  <link href="../style/thinktank.css" type="text/css" rel="stylesheet" />
	<link href="../bootstrap/css/bootstrap.css" type="text/css" rel="stylesheet" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

</head>
<body>

	<div class="input-group" style="width:1200px">
		<input type="text" class="form-control" placeholder="索" style="height:38px" id="inpt" >
			<span class="input-group-btn">
				<button id="srch" class="btn btn-default" style="height:38px"><i class="glyphicon glyphicon-search"></i></button>
				<button id="home" class="btn btn-default" style="height:38px"><i class="glyphicon glyphicon-home"></i></button>
				<button id="list" class="btn btn-default" style="height:38px"><i class="glyphicon glyphicon-list"></i></button>
				<button id="show" class="btn btn-default" style="height:38px"><i class="glyphicon glyphicon-eye-open"></i></button>
				<button id="save" class="btn btn-default" style="height:38px"><i class="glyphicon glyphicon-cloud-upload"></i></button>
				<button id="dele" class="btn btn-default" style="height:38px"><i class="glyphicon glyphicon-trash"></i></button>
				<button id="crea" class="btn btn-default" style="height:38px"><i class="glyphicon glyphicon-plus"></i></button>

				<button class="btn btn-default dropdown-toggle" data-toggle="dropdown" style="height:38px"><i class="glyphicon glyphicon-font"></i><span class="caret"></span></button>
				<ul class="dropdown-menu" id="font-size">
					<li><a href="#" data-size="10">小</a></li>
					<li><a href="#" data-size="12">並</a></li>
					<li><a href="#" data-size="14">大</a></li>
				</ul>
			</span>
		</div>
		
		<div id="editor" style="height:500px;width:1200px"></div>
		
	</div>
	
	<script src="../bootstrap/js/bootstrap.js"></script>
	<script src="../ace/ace.js"></script>
	<script src="../ace/ext-linking.js"></script>

	<script>
		var idhist = [ '0000-00-00-000000' ];
		var curpos = 0;
		var maxpos = 0;
		function memoid( nextid = null ){
		}
		

		var curid = '0000-00-00-000000';
		var base  = 'http://127.0.0.1:20091/thinktank/memos';

		function howm( id = null, opt = {} ){
		  switch(true){
		  case id == null: return base + '/' + curid + '.howm';
      case id == ''  : return base + '.howm';
      default        : return base + '/' + id + '.howm';
		  }
		}

		function show(e){ $.ajax( howm(), { type: "GET", success: function(dat){ editor.selectAll(); editor.removeLines(); editor.insert(dat); $('title').text(curid+'.howm'); } }); }
		function save(e){ $.ajax( howm(), { type: "PUT", data: { content: editor.getValue() }, success: function(e){ show(); } }); }
		function crea(e){ $.ajax( howm(''), { type: "POST", success: function(dat){ curid = dat; show(e); } }); }
		function home(e){ history.pushState(curid, null, howm()); curid = '0000-00-00-000000'; show(e); }
		function dele(e){ $.ajax( howm(), { type: "DELETE", success: function(dat){ home(e); } }) }
		function list(e){ $.ajax( howm(''), { type: "GET", success: function(dat){ editor.selectAll(); editor.removeLines(); editor.insert(dat); $('title').text('list'); } }); }
		function srch(e){ $.ajax( howm(''), { type: "GET", data: { keyword: $('#inpt').val() }, success: function(dat){
		    editor.selectAll(); editor.removeLines(); editor.insert(dat);
        $('title').text('list');
		   } }); }
		function click(data){
		  txt = data.token.value
		  if( /^http/.test( txt ) ) {
		    window.open( txt, "_blank" );
		  } else {
		    history.pushState(curid, null, howm());
		    curid = txt.substr( 0, 17 );
		    show();
		  }
		} 

		show();
		history.pushState(curid, null, howm());

    var editor = ace.edit("editor");
		editor.$blockScrolling = Infinity;
    editor.setTheme("../ace/theme/idle_fingers");
		editor.getSession().setMode("../ace/mode/thinktank");
		editor.setKeyboardHandler("ace/keyboard/emacs");

		editor.setFontSize(13);
		editor.getSession().setUseWrapMode(true);
		editor.getSession().setTabSize(2);
		editor.renderer.setShowGutter(false);

		editor.setOptions( { enableLinking: true } );
		
		editor.on("linkClick", click );

		$('#font-size').click(function(e) { editor.setFontSize($(e.target).data('size')); });
		$('#home').click( home );
		$('#save').click( save );
		$('#show').click( show );
		$('#crea').click( crea );
		$('#dele').click( dele );
		$('#list').click( list );
		$('#srch').click( function(e){ srch(e); });
		$('#inpt').keypress( function(e){ if( e.which == 13 ){ srch(e); return false; } });

</script>

	
</br>

</body>
</html>

      
